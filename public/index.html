<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A Fazenda 2025 – 8ª Roça</title>
  <style>
    body{font-family:Arial,sans-serif;max-width:600px;margin:40px auto;padding:20px;background:#111;color:#fff;text-align:center}
    h1{color:#00c853;font-size:1.8em}
    .poll{background:#222;padding:25px;border-radius:15px;margin-top:20px}
    .option{margin:30px 0;display:flex;gap:20px;align-items:center;justify-content:center}
    .bar{height:50px;background:#00c853;border-radius:10px;text-align:right;padding-right:15px;line-height:50px;color:#000;font-weight:bold;font-size:1.3em}
    img{width:110px;height:110px;border-radius:50%;object-fit:cover;border:5px solid #00c853}
    .updated{margin-top:30px;opacity:0.8;font-size:0.9em}
  </style>
</head>
<body>
  <h1>A Fazenda 2025<br><small>8ª Roça – Enquete UOL</small></h1>
  <div class="poll" id="poll">Carregando enquete…</div>
  <div class="updated" id="updated"></div>

  <script>
    async function atualizar() {
      try {
        const res = await fetch('/api/poll');
        const poll = await res.json();
        if (poll.error) throw poll.error;

        let html = `<h2>Quem você quer que fique na roça?</h2>`;
        html += `<p><strong>Total: ${poll.totalVotes}</strong></p><hr>`;

        poll.result.forEach(p => {
          const pct = parseFloat(p.vote.replace(',','.'));
          html += `
            <div class="option">
              <img src="${p.image.src.replace('80x80','150x150')}" alt="${p.label}">
              <div style="flex:1;text-align:left">
                <strong style="font-size:1.5em">${p.label}</strong><br>
                <div class="bar" style="width:${pct*4}%">${p.vote}</div>
              </div>
            </div>`;
        });

        document.getElementById('poll').innerHTML = html;
        document.getElementById('updated').textContent = "Atualizado: " + new Date().toLocaleString('pt-BR');
      } catch (e) {
        document.getElementById('poll').innerHTML = "<p style='color:#f66'>Erro temporário – recarregando em 10s</p>";
      }
    }

    atualizar();
    setInterval(atualizar, 90000);
  </script>
</body>
</html>
